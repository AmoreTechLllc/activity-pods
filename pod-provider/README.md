# Pod provider documentation

This directory contains the code of the Pod provider, with both the backend and frontend.

Please see the [documentation website](https://docs.activitypods.org) for more informations.

## Getting started

### Launch Fuseki and Redis

```bash
make start
```

### Launch the backend

```bash
cd backend
yarn install
yarn run dev
```

### Launch the frontend

```bash
cd frontend
yarn install
yarn start
```

## Linking to SemApps packages

To modify packages on the [SemApps repository](https://github.com/assemblee-virtuelle/semapps) and see the changes before they are published on NPM, see the following instructions.

### Linking backend packages

To link backend packages, you can use [`yarn link`](https://classic.yarnpkg.com/en/docs/cli/link/).

```bash
cd /SEMAPPS_REPO/src/middleware
yarn run link-all
cd /ACTIVITYPODS_REPO/pod-provider/backend
yarn run link-semapps-packages
```

### Linking frontend packages

Linking frontend packages with `yarn link` doesn't work because it causes version mismatch errors for React and MUI (see [this PR](https://github.com/assemblee-virtuelle/semapps/pull/1180) for explainations). So you should use [Yalc](https://github.com/wclr/yalc) instead. Fortunately, we make it easy for you.

```bash
cd /SEMAPPS_REPO/src/frontend
yarn run yalc:publish
cd /ACTIVITYPODS_REPO/pod-provider/frontend
yarn run link-semapps-packages
```

Additionally, frontend packages need to be rebuilt on every changes, or they will not be taken into account by ActivityPods. You can use `yarn run build` to build a package once, or `yarn run watch` to rebuild a package on every change. On every build, the new package will be published to Yalc.

Thanks to Git hooks, the frontend packages will also be published to Yalc whenever git branches are changed.

## Maintainance

We recommend to regularly compact the datasets generated by Fuseki, otherwise they may grow very large. Unfortunately, due to the [extension we developed to handle WAC permissions](https://semapps.org/docs/triplestore), it is required to stop Fuseki, compact it and launch it again.

```bash
make compact-datasets
```
